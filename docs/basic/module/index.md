---
title: 模块机制
---

在 Node 中，模块分为两类:一类是 Node 提供的模块，称为核**心模块**;另一类是用户编写的模块，称为**文件模块**

- 核心模块部分在 Node 源代码的编译过程中，编译进了二进制执行文件。在 Node 进程启动 时，部分核心模块就被直接加载进内存中，所以这部分核心模块引入时，文件定位和编 译执行这两个步骤可以省略掉，并且在路径分析中优先判断，所以它的加载速度是最 快的。
- 文件模块则是在运行时动态加载，需要完整的路径分析、文件定位、编译执行过程，速 度比核心模块慢。

## 文件定位

### 文件扩展名分析

CommonJS 模块规范也允许在标识符中不包含文件扩展名，这种情况下，Node 会按`.js`、`.json`、`.node` 的次序补足扩展名，依次尝试。

### 目录分析和包

1. 在当前目录下查找`package.json`(CommonJS 包规范定义的包描述文件)
2. 通过`JSON.parse()`解析出包描述对象
3. 从中取出 main 属性指定的文件名进行定位。
4. 如果文件名缺少扩展名，将会进入扩展名分析的步骤。

如果 main 属性指定的文件名错误，或者压根没有 package.json 文件，Node 会将 index 当做默 认文件名，然后依次查找 index.js、index.json、index.node。
